<%
html = options.data['html']
doc =  Nokogiri::HTML(html)
html = doc.xpath('//object').to_s

thumbnail_width = options.data['thumbnail_width']
thumbnail_height = options.data['thumbnail_height']
if thumbnail_width.blank? || thumbnail_width.to_i > maxwidth
  thumbnail_width = maxwidth
  thumbnail_height = nil
end

thumbnail_img = tag(:img, {:src => options.data['thumbnail_url'], :width => thumbnail_width, :height => thumbnail_height, :title => options.data['title'], :alt => options.data['title'], :id => "post_stream_thumbnail_#{post.id}", :class => 'post_stream_thumbnail'}.delete_if{|k,v| v.blank?})

%>
<% if html.blank? -%>
  <%= content_tag(:a, thumbnail_img, {:href => post.link, :rel => 'nofollow', :target => '_blank'}, false) if options.data['thumbnail_url'] %>
<% else -%>
  <a href="javascript:void(0);" onclick="PostStream.embed('<%= jvh html %>', '<%= post.id %>');"><%= thumbnail_img %></a>
  <%= content_tag(:div, '', {:id => "post_stream_embed_#{post.id}", :class => 'post_stream_embed', :style => "display:none; width:#{options.data['width']}px; height:#{options.data['height']}px;"}) %>
<% end -%>
